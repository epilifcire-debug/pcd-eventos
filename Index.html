<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema PCD Eventos</title>
<style>
  body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #8338ec, #ff006e, #ffbe0b);
    background-attachment: fixed;
    color: #222;
  }

  header {
    text-align: center;
    padding: 15px;
  }

  header img {
    width: 120px;
    border-radius: 50%;
    margin-bottom: 10px;
  }

  h1 {
    margin: 5px 0;
    color: #fff;
    font-weight: 600;
  }

  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 25px;
    padding: 20px;
  }

  .card {
    background: #fff;
    width: 90%;
    max-width: 900px;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }

  .card h2 {
    margin-top: 0;
    color: #333;
    border-bottom: 2px solid #eee;
    padding-bottom: 8px;
  }

  input, select {
    padding: 8px;
    margin: 5px;
    border: 1px solid #ccc;
    border-radius: 6px;
    width: calc(100% - 20px);
    box-sizing: border-box;
  }

  button {
    background: #8338ec;
    color: white;
    padding: 10px 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 8px;
    transition: 0.2s;
  }

  button:hover { background: #6f31c8; }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }

  th, td {
    padding: 8px;
    border: 1px solid #ccc;
    text-align: left;
  }

  th {
    background: #8338ec;
    color: white;
  }

  .circle-status {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-left: 8px;
  }
  .verde { background: #1ed760; }
  .vermelho { background: #ff4d4d; }

  .ghost {
    background: transparent;
    color: #8338ec;
    border: 1px solid #8338ec;
    border-radius: 5px;
    padding: 5px 10px;
    cursor: pointer;
  }

  .ghost:hover {
    background: #8338ec;
    color: #fff;
  }

  #toggle-theme {
    position: fixed;
    top: 15px;
    right: 15px;
    background: #fff;
    color: #333;
    border: none;
    border-radius: 50%;
    padding: 10px;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  }

  /* Modal */
  #modal-docs, #modal-backdrop {
    display: none;
    position: fixed;
    inset: 0;
  }

  #modal-backdrop {
    background: rgba(0,0,0,0.6);
    z-index: 10;
  }

  #modal-docs {
    z-index: 11;
    background: #fff;
    width: 90%;
    max-width: 500px;
    margin: auto;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    border-radius: 12px;
    padding: 20px;
  }

  #modal-docs h3 {
    margin-top: 0;
    text-align: center;
  }

  .hidden { display: none; }

  /* Tema escuro */
  body.dark {
    background: #121212;
    color: #eee;
  }
  body.dark .card {
    background: #1e1e1e;
    color: #eee;
  }
  body.dark th {
    background: #ff006e;
  }
  body.dark button {
    background: #ff006e;
  }
  body.dark .ghost {
    color: #ff006e;
    border-color: #ff006e;
  }

  footer {
    text-align: center;
    padding: 10px;
    color: #fff;
  }
</style>
</head>
<body>
<header>
  <img src="logo.png" alt="Logo">
  <h1>Sistema PCD Eventos</h1>
</header>

<button id="toggle-theme">üåô</button>

<main>
  <div class="card" id="card-admin" style="display:none;">
    <h2>Painel do Administrador</h2>
    <p>Bem-vindo, administrador! Gerencie logs e cadastros.</p>
    <button id="btn-ver-logs">üìã Ver Logs de Uploads</button>
  </div>

  <div class="card">
    <h2>Cadastro de Pessoas</h2>
    <input id="p-nome" placeholder="Nome completo">
    <input id="p-cpf" placeholder="CPF">
    <input id="p-tel" placeholder="Telefone (opcional)">
    <button id="p-salvar">Salvar</button>
    <p id="p-msg" class="hidden" style="color:red;">Preencha os campos obrigat√≥rios</p>

    <table>
      <thead>
        <tr><th>Nome</th><th>CPF</th><th>A√ß√µes</th></tr>
      </thead>
      <tbody id="tabela-pessoas"></tbody>
    </table>
  </div>
</main>

<!-- Modal Documentos -->
<div id="modal-backdrop"></div>
<div id="modal-docs">
  <h3>Envio de Documentos</h3>
  <p><strong id="docs-nome"></strong></p>
  <label>Foto (obrigat√≥rio): <input type="file" id="doc-foto" accept=".jpg,.jpeg,.png"></label><br>
  <label>Documento nacional com foto (obrigat√≥rio): <input type="file" id="doc-doc-nacional" accept=".jpg,.jpeg,.png"></label><br>
  <label>Cadastro Cad√önico (obrigat√≥rio): <input type="file" id="doc-cad" accept=".jpg,.jpeg,.png"></label><br>
  <label>Comprovante de resid√™ncia (obrigat√≥rio): <input type="file" id="doc-comprovante" accept=".jpg,.jpeg,.png"></label><br>
  <label>Cart√£o BPC (opcional): <input type="file" id="doc-bpc" accept=".pdf"></label><br>
  <label>Documento INSS (opcional): <input type="file" id="doc-inss" accept=".pdf"></label><br>
  <label>Laudo m√©dico (opcional): <input type="file" id="doc-laudo" accept=".pdf"></label><br>

  <div style="text-align:center;margin-top:10px;">
    <button id="btn-docs-enviar">Enviar</button>
    <button id="btn-docs-cancelar" class="ghost">Cancelar</button>
  </div>
</div>

<footer>
  <p>¬© 2025 Sistema PCD Eventos</p>
</footer>
<script>
// ============================
//  CONFIGURA√á√ÉO INTELIGENTE
// ============================
const BASE_URL = window.location.hostname.includes("localhost")
  ? "http://localhost:3000"
  : "https://pcd-eventos.onrender.com";

console.log("üåê Ambiente detectado:", BASE_URL);

// ============================
//  SIMULA√á√ÉO DE LOGIN / PERFIL
// ============================
// Caso voc√™ j√° tenha login real, substitua este bloco.
if (!localStorage.getItem("perfil")) {
  const perfil = prompt("Digite seu perfil: admin ou usuario");
  localStorage.setItem("perfil", perfil === "admin" ? "admin" : "usuario");
}
const perfilUsuario = localStorage.getItem("perfil");
if (perfilUsuario === "admin") {
  document.getElementById("card-admin").style.display = "block";
}

// ============================
//  VARI√ÅVEIS GERAIS
// ============================
let pessoas = JSON.parse(localStorage.getItem("pessoas") || "[]");
const tabelaPessoas = document.getElementById("tabela-pessoas");
const msgP = document.getElementById("p-msg");
const modal = document.getElementById("modal-docs");
const backdrop = document.getElementById("modal-backdrop");
const docsNome = document.getElementById("docs-nome");
let pessoaSelecionada = null;

// ============================
//  SALVAR PESSOA
// ============================
document.getElementById("p-salvar").addEventListener("click", () => {
  const nome = document.getElementById("p-nome").value.trim();
  const cpf = document.getElementById("p-cpf").value.trim();
  const tel = document.getElementById("p-tel").value.trim();

  if (!nome || !cpf) {
    msgP.textContent = "Preencha nome e CPF!";
    msgP.classList.remove("hidden");
    setTimeout(() => msgP.classList.add("hidden"), 2000);
    return;
  }

  const existente = pessoas.find(p => p.cpf === cpf);
  if (existente) {
    existente.nome = nome;
    existente.tel = tel;
  } else {
    pessoas.push({ nome, cpf, tel, documentosCompletos: false });
  }

  localStorage.setItem("pessoas", JSON.stringify(pessoas));
  document.getElementById("p-nome").value = "";
  document.getElementById("p-cpf").value = "";
  document.getElementById("p-tel").value = "";
  renderPessoas();
});

// ============================
//  RENDERIZAR TABELA
// ============================
function renderPessoas() {
  tabelaPessoas.innerHTML = "";
  pessoas.sort((a, b) => a.nome.localeCompare(b.nome));
  pessoas.forEach(p => {
    const tr = document.createElement("tr");
    const cor = p.documentosCompletos ? "verde" : "vermelho";
    tr.innerHTML = `
      <td>${p.nome} <span class="circle-status ${cor}"></span></td>
      <td>${p.cpf}</td>
      <td>
        <button class="ghost btn-docs" data-cpf="${p.cpf}">üì§ Enviar Documentos</button>
        <button class="ghost btn-view" data-cpf="${p.cpf}">üëÅÔ∏è Visualizar</button>
      </td>`;
    tabelaPessoas.appendChild(tr);
  });

  document.querySelectorAll(".btn-docs").forEach(btn => {
    btn.addEventListener("click", () => abrirModal(btn.dataset.cpf));
  });

  document.querySelectorAll(".btn-view").forEach(btn => {
    btn.addEventListener("click", () => {
      const pessoa = pessoas.find(p => p.cpf === btn.dataset.cpf);
      if (pessoa) window.open(`${BASE_URL}/documentos/${encodeURIComponent(pessoa.nome)}/`, "_blank");
    });
  });
}

renderPessoas();

// ============================
//  MODAL DOCUMENTOS
// ============================
function abrirModal(cpf) {
  pessoaSelecionada = pessoas.find(p => p.cpf === cpf);
  if (!pessoaSelecionada) return;
  docsNome.textContent = pessoaSelecionada.nome;
  modal.style.display = "block";
  backdrop.style.display = "block";
}

document.getElementById("btn-docs-cancelar").addEventListener("click", () => {
  modal.style.display = "none";
  backdrop.style.display = "none";
});

// ============================
//  ENVIAR DOCUMENTOS
// ============================
document.getElementById("btn-docs-enviar").addEventListener("click", async () => {
  if (!pessoaSelecionada) return;

  const formData = new FormData();
  formData.append("nomePessoa", pessoaSelecionada.nome);

  const obrigatorios = ["foto", "doc-nacional", "cad", "comprovante"];
  const campos = {
    "foto": document.getElementById("doc-foto").files[0],
    "doc-nacional": document.getElementById("doc-doc-nacional").files[0],
    "cad": document.getElementById("doc-cad").files[0],
    "comprovante": document.getElementById("doc-comprovante").files[0],
    "bpc": document.getElementById("doc-bpc").files[0],
    "inss": document.getElementById("doc-inss").files[0],
    "laudo": document.getElementById("doc-laudo").files[0]
  };

  let faltando = false;
  obrigatorios.forEach(c => {
    if (!campos[c]) faltando = true;
  });

  for (let key in campos) {
    if (campos[key]) formData.append(key, campos[key]);
  }

  try {
    const resposta = await fetch(`${BASE_URL}/upload`, { method: "POST", body: formData });
    const resultado = await resposta.json();

    if (faltando) {
      alert("Envie todos os documentos obrigat√≥rios para que apare√ßa nos relat√≥rios.");
      pessoaSelecionada.documentosCompletos = false;
    } else {
      alert("Documentos enviados com sucesso!");
      pessoaSelecionada.documentosCompletos = true;
    }

    localStorage.setItem("pessoas", JSON.stringify(pessoas));
    modal.style.display = "none";
    backdrop.style.display = "none";
    renderPessoas();
    console.log("üì§ Upload conclu√≠do:", resultado);
  } catch (e) {
    alert("‚ùå Erro ao enviar documentos!");
    console.error(e);
  }
});

// ============================
//  BOT√ÉO DE LOGS (SOMENTE ADMIN)
// ============================
document.getElementById("btn-ver-logs").addEventListener("click", () => {
  if (perfilUsuario === "admin") {
    window.open(`${BASE_URL}/logs?perfil=admin`, "_blank");
  } else {
    alert("Acesso negado. Somente administradores podem ver os logs.");
  }
});

// ============================
//  TEMA CLARO/ESCURO
// ============================
const btnTheme = document.getElementById("toggle-theme");
btnTheme.addEventListener("click", () => {
  document.body.classList.toggle("dark");
  btnTheme.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
});
</script>
</body>
</html>
